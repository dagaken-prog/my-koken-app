成年後見業務支援システム 運用・開発マニュアル

1. システムの概要

本システムは、成年後見業務における「利用者情報」と「活動記録」を管理するためのアプリケーションです。

PC（Windows）とクラウド（Streamlit Community Cloud）を連携させ、以下の環境を実現しています。

データ保存場所:
Googleスプレッドシート（クラウド上の台帳）

プログラム管理:
GitHub（プログラムの設計図置き場）

利用端末:
PC、スマートフォン、タブレット等（ブラウザがあれば利用可能）

データの安全性について

プログラム（アプリ）とデータ（スプレッドシート）は分離されています。
そのため、プログラムの改良中にミスがあっても、過去に記録したデータが消えることはありません。

2. 日常の業務利用（閲覧・入力）

日々の記録や確認は、Webブラウザ経由で行います。PCの電源を入れる必要はありません。

アクセス:
スマホやタブレットで、発行されたURL（https://my-kouken-app.streamlit.app 等）にアクセスします。

ログイン:
設定したパスワードを入力してログインします。

メニュー操作:

利用者一覧・活動記録: 既存データの閲覧、活動日誌の入力。

基本情報登録: 新しい利用者の登録、または既存情報の修正。

データ管理・移行: CSVファイルによる一括取り込み。

3. システム開発・修正の流れ

機能を追加したり、画面の文言を修正したりする場合は、PC上の「開発環境」で作業を行います。
複数のPC（自宅・職場など）で作業する場合は、必ず以下の「同期」手順を守ってください。

【重要】作業の鉄則

「作業前には必ずダウンロード（Pull）、作業後には必ずアップロード（Push）」

手順①：作業前の同期（ダウンロード）

PCを起動し、作業を始める前に必ず行います。

kouken_system フォルダを開きます。

0_sync_download.bat をダブルクリックします。

「最新の状態になりました！」と表示されたら、作業を開始します。

※これを忘れると、別の場所で行った修正が消えてしまう（競合する）恐れがあります。

手順②：プログラムの編集

Visual Studio Code (VS Code) を使用して編集します。

VS Codeを開き、kouken_system フォルダを開きます。

app_deploy.py を選択し、コードを修正します。

修正が終わったら Ctrl + S で上書き保存します。

手順③：動作確認（テスト）

編集した内容が正しく動くか、自分のPC内で確認します。まだWeb上には反映されません。

フォルダ内の start_cloud_app.bat をダブルクリックします。

ブラウザが立ち上がり、アプリが表示されます（パスワードは admin です）。

エラーが出ないか、修正箇所が反映されているか確認します。

修正が必要な場合は、VS Codeで直して保存し、ブラウザの「更新ボタン」を押せば即座に反映されます。

手順④：本番への反映（アップロード）

テストで問題なければ、クラウド（Webアプリ）へ反映させます。

テスト用の黒い画面やブラウザを閉じます。

フォルダ内の 2_update_cloud.bat をダブルクリックします。

「[成功] アップロード完了！」と表示されたら完了です。

数秒～数十秒で、スマホ側のアプリも自動的に更新されます。

4. フォルダ構成とファイルの役割

kouken_system フォルダ内にある主要なファイルの役割です。

ファイル名

役割

備考

app_deploy.py

アプリ本体

プログラムのメインファイル。編集対象はこれです。

credentials.json

Googleの鍵

【最重要】 これがないと動きません。他人に渡したり、GitHubに上げたりしてはいけません。

requirements.txt

部品リスト

必要なライブラリ名が書かれています。新しいライブラリを使う時だけ追記します。

0_sync_download.bat

同期ボタン

クラウドから最新コードを取得します（作業開始時に使用）。

start_cloud_app.bat

起動ボタン

PC上でテスト起動します（編集・確認時に使用）。

2_update_cloud.bat

更新ボタン

編集内容をクラウドへ送信します（作業終了時に使用）。

fix_git_ignore.bat

修正ツール

Googleドライブ内のショートカット等が邪魔をした際に除外設定を追加します。

5. トラブルシューティング

Q. スマホでアクセスできない、エラーが出る

Streamlit Community Cloudの管理画面で、右下の「Manage app」からログ（記録）を確認してください。

「Secrets」の設定（パスワードや鍵情報）が消えていないか確認してください。

Q. 「項目が見つかりません」等のエラーが出る

プログラムで項目（列）を増やした場合、Googleスプレッドシート側の列が足りなくなっている可能性があります。

対処法: Googleスプレッドシートを開き、該当するシート（Personsなど）を削除してください。その後アプリを再読み込みすると、新しい項目でシートが自動再生成されます。

Q. 更新ボタンを押したらエラーが出た

「rejected」などのエラーが出る場合、別のPCでの更新を取り込んでいない可能性があります。

まず 0_sync_download.bat を試してください。それでも解決しない場合は、2_update_cloud.bat（強制上書き版）を実行することで、現在のPCの内容を正として上書きできます。